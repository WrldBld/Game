# Visual State Catalog UI Design

## Overview

This document provides UI/UX mockups for the **Visual State Catalog** feature, enabling DMs to select, preview, and generate visual states for locations and regions during pre-staging and staging approval workflows.

**Design Goals:**
- Seamless integration with existing staging approval UI
- Clear visual feedback for state selection vs generation
- Preview-first approach for state browsing
- Fast path for quick selection, deep path for customization

---

## User Stories

### US-VSC-001: As a DM, I can browse available visual states for a region in pre-stage
- Browse all cataloged states for location/region
- See thumbnails, descriptions, and match reasons
- Filter by tags or search by name/description

### US-VSC-002: As a DM, I can select an existing visual state during pre-staging
- Dropdown with state names for quick selection
- Inline preview of selected state
- Clear indication of auto-resolved state vs manual selection

### US-VSC-003: As a DM, I can generate a new visual state when catalog options don't fit
- "Generate New" button next to state dropdowns
- Generation modal with description/prompt input
- Generated state saved to catalog automatically

### US-VSC-004: As a DM, I can preview visual state details before committing
- Thumbnail preview with backdrop, atmosphere text
- Full description and generation prompt
- Asset paths (backdrop, map, sound)
- Activation rules (if any)

### US-VSC-005: As a DM, I can override auto-resolved visual state in staging approval
- Dropdowns populated with catalog states
- "Default (auto-resolved)" option
- Match reason shown for auto-resolved state

---

## User Flows

### Flow 1: Pre-Stage with Existing State

```
[DM opens Location â†’ Staging tab]
    â†“
[DM clicks "Pre-Stage Now" on region]
    â†“
[Pre-Stage Modal opens with NPC checkboxes]
    â†“
[Visual State dropdown shows available states]
    â†“
[DM selects "Stormy Night" from dropdown]
    â†“
[Inline preview shows thumbnail + description]
    â†“
[DM confirms staging]
```

### Flow 2: Pre-Stage with New Generated State

```
[DM opens Location â†’ Staging tab]
    â†“
[DM clicks "Pre-Stage Now" on region]
    â†“
[Pre-Stage Modal opens]
    â†“
[DM browses dropdown, no state fits]
    â†“
[DM clicks "Generate New" next to dropdown]
    â†“
[Visual State Generation Modal opens]
    â†“
[DM enters description: "Rain-soaked streets, flickering lanterns"]
    â†“
[Generation completes, state saved to catalog]
    â†“
[New state auto-selected in dropdown, preview shown]
    â†“
[DM confirms staging]
```

### Flow 3: Staging Approval with State Override

```
[Player enters unstaged region]
    â†“
[Server sends StagingApprovalRequired with resolved visual state]
    â†“
[Staging Approval Popup opens]
    â†“
[Visual State section shows "Stormy Night" (auto-resolved)]
    â†“
[Match reason: "TimeOfDay(Night) + weather flag"]
    â†“
[DM wants different atmosphere, opens dropdown]
    â†“
[DM selects "Festival Evening" from catalog]
    â†“
[Preview updates with new state]
    â†“
[DM approves with custom state]
```

---

## UI Mockups

### Pre-Stage Modal with Visual State Selection

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ­ Pre-Stage: Bar Counter                                       [X]        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  Set up NPCs and appearance before players arrive.                          â”‚
â”‚  Current game time: Day 3, Evening (7:30 PM)                                â”‚
â”‚                                                                             â”‚
â”‚  â”€â”€â”€ NPCs in Scene â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                             â”‚
â”‚  Select NPCs to be present:                                                  â”‚
â”‚  [âœ“] Marcus the Bartender    [ ] Hidden                                     â”‚
â”‚  [âœ“] Old Sal                 [ ] Hidden                                     â”‚
â”‚  [ ] Mysterious Stranger      [ ] Hidden                                     â”‚
â”‚                                                                             â”‚
â”‚  â”€â”€â”€ Scene Appearance â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                             â”‚
â”‚  Location State: [â–¼ Default (auto-resolved) ]   [Generate New â¤]          â”‚
â”‚                   â”‚                                                           â”‚
â”‚                   â”œâ”€ Default (auto-resolved)                                 â”‚
â”‚                   â”œâ”€ Festival of Lights (Week 3)                            â”‚
â”‚                   â””â”€ Under Siege (city_siege flag)                          â”‚
â”‚                                                                             â”‚
â”‚  Region State:   [â–¼ Evening                     ]   [Generate New â¤]          â”‚
â”‚                   â”‚                                                           â”‚
â”‚                   â”œâ”€ Default (auto-resolved)                                 â”‚
â”‚                   â”œâ”€ Morning (TimeOfDay)                                    â”‚
â”‚                   â”œâ”€ Evening (TimeOfDay)    â† Selected                       â”‚
â”‚                   â””â”€ Post-Explosion (event triggered)                       â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ–¼ï¸ Preview: Evening                                             â”‚   â”‚
â”‚  â”‚                                                                    â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚ â”‚  [Thumbnail: Warm candlelight bar scene]                     â”‚ â”‚   â”‚
â”‚  â”‚ â”‚  200x120px placeholder image                                 â”‚ â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                                                                    â”‚   â”‚
â”‚  â”‚ "Warm candlelight flickers across polished brass fixtures. The    â”‚   â”‚
â”‚  â”‚  usual evening crowd fills the bar with hushed conversations..."  â”‚   â”‚
â”‚  â”‚                                                                    â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚ â”‚ Backdrop: /assets/bar_counter_evening.png                     â”‚ â”‚   â”‚
â”‚  â”‚ â”‚ Sound:    /audio/tavern_evening.ogg                            â”‚ â”‚   â”‚
â”‚  â”‚ â”‚ Match:    TimeOfDay(Evening) matches (7:30 PM)                â”‚ â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                                                      [ğŸ” Details]â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  â”€â”€â”€ Duration â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Valid for: [â–¼ 4 hours ] (until 11:30 PM game time)                         â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚     Cancel            â”‚  â”‚      Pre-Stage Region                   â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Context**: Pre-stage modal when DM sets up region before players arrive
**Interactions**:
- [Generate New â¤] â†’ Opens `VisualStateGenerationModal`
- [â–¼] Dropdown â†’ Shows catalog states with match reasons
- [ğŸ” Details] â†’ Opens `VisualStateDetailsModal`
- Dropdown change â†’ Updates preview inline
- "Pre-Stage Region" â†’ Sends staging with selected state IDs

---

### Visual State Generation Modal

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¨ Generate Visual State                                     [X]        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  Region: The Bar Counter (Rusty Anchor Tavern)                              â”‚
â”‚  Scope: Region State                                                        â”‚
â”‚                                                                             â”‚
â”‚  â”€â”€â”€ Describe the Scene â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                             â”‚
â”‚  Enter a description of how this region should look:                        â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Rain-soaked cobblestones outside. Dim lantern light flickers through â”‚   â”‚
â”‚  â”‚ the fog. Patrons speak in hushed tones about the strange events...   â”‚   â”‚
â”‚  â”‚                                                             (437/500)  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  â”€â”€â”€ Quick Presets â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  [ğŸŒ§ï¸ Rainy Night]    [ğŸŒ™ Moonlit]    [ğŸ”¥ Festive]    [ğŸ’€ Eerie]           â”‚
â”‚                                                                             â”‚
â”‚  â”€â”€â”€ Optional: Generation Guidance â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Add specific details for asset generation:                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Atmosphere: Foggy, mysterious                                       â”‚   â”‚
â”‚  â”‚ Lighting: Dim lantern light, flickering                             â”‚   â”‚
â”‚  â”‚ Mood: Tense, whispering patrons                                     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  â”€â”€â”€ Tags (Optional) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Tags help categorize states for future selection:                         â”‚
â”‚  [Weather: Rain] [Time: Night] [Mood: Mysterious] [+ Add Tag]             â”‚
â”‚                                                                             â”‚
â”‚  â”€â”€â”€ Generation Options â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                             â”‚
â”‚  Generate: [âœ“] Backdrop    [âœ“] Atmosphere Text    [âœ“] Ambient Sound      â”‚
â”‚                                                                             â”‚
â”‚  Asset Style: [â–¼ Fantasy Realistic         ]                                 â”‚
â”‚                 â”‚                                                           â”‚
â”‚                 â”œâ”€ Fantasy Realistic (default)                              â”‚
â”‚                 â”œâ”€ Anime/Visual Novel                                        â”‚
â”‚                 â”œâ”€ Pixel Art                                                 â”‚
â”‚                 â””â”€ Dark/Noir                                                â”‚
â”‚                                                                             â”‚
â”‚  â”€â”€â”€ Preview â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                    â”‚   â”‚
â”‚  â”‚  [Loading spinner]                                                 â”‚   â”‚
â”‚  â”‚  Generating visual assets...                                         â”‚   â”‚
â”‚  â”‚                                                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  (Shows after generation completes)                                           â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚                                                                    â”‚   â”‚
â”‚  â”‚  [Thumbnail of generated backdrop]                                â”‚   â”‚
â”‚  â”‚                                                                    â”‚   â”‚
â”‚  â”‚  "Rain-soaked cobblestones glisten in the flickering lantern light.â”‚   â”‚
â”‚  â”‚   The fog creates an air of mystery..."                            â”‚   â”‚
â”‚  â”‚                                                                    â”‚   â”‚
â”‚  â”‚  Generated: 2026-01-22 19:45                                       â”‚   â”‚
â”‚  â”‚                                                                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚     Cancel            â”‚  â”‚      Save & Use in Staging              â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Context**: DM creates new visual state when catalog options don't fit
**Interactions**:
- Description textarea â†’ Character counter (max 500)
- Quick Presets â†’ Pre-fills description + tags
- [Generate] â†’ Triggers ComfyUI workflow, shows loading state
- [Save & Use in Staging] â†’ Saves to catalog, returns ID to calling modal
- Auto-assigns ID based on description hash + style config

---

### Visual State Details Modal

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ–¼ï¸ Visual State Details: Evening                              [X]        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  [Full-size backdrop image preview]                             â”‚   â”‚
â”‚  â”‚  800x450px (scaled to fit modal)                                 â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  â”€â”€â”€ Description â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                             â”‚
â”‚  "Warm candlelight flickers across polished brass fixtures. The usual       â”‚
â”‚  evening crowd fills the bar with hushed conversations. Marcus polishes     â”‚
â”‚  glasses behind the counter while Old Sal holds court at the corner         â”‚
â”‚  table."                                                                    â”‚
â”‚                                                                             â”‚
â”‚  â”€â”€â”€ Activation Rules â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                             â”‚
â”‚  +â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€+   â”‚
â”‚  â”‚ Rule 1: TimeOfDay(Evening)                                      â”‚   â”‚
â”‚  â”‚ Reasoning: Matches when game time is 6:00 PM - 8:00 PM           â”‚   â”‚
â”‚  +â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€+   â”‚
â”‚                                                                             â”‚
â”‚  â”€â”€â”€ Assets â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                             â”‚
â”‚  Backdrop: /assets/bar_counter_evening.png                                  â”‚
â”‚  [ğŸ”— View Full] [ğŸ“¥ Download]                                               â”‚
â”‚                                                                             â”‚
â”‚  Sound: /audio/tavern_evening.ogg                                           â”‚
â”‚  [â–¶ï¸ Preview] [ğŸ“¥ Download]                                                 â”‚
â”‚                                                                             â”‚
â”‚  Map Overlay: (none)                                                        â”‚
â”‚                                                                             â”‚
â”‚  Atmosphere:                                                                â”‚
â”‚  - Lighting: Warm candlelight                                              â”‚
â”‚  - Weather: Clear                                                           â”‚
â”‚  - Mood: Relaxed, conversational                                            â”‚
â”‚                                                                             â”‚
â”‚  â”€â”€â”€ Metadata â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                             â”‚
â”‚  Created: 2026-01-15 14:32 by DungeonMaster                                  â”‚
â”‚  Tags: [Time: Evening] [Weather: Clear] [Mood: Relaxed]                     â”‚
â”‚  Usage count: 12                                                            â”‚
â”‚  ID: vs_region_123e4567e89b12d3                                             â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                          Edit State        â”‚ â”‚                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Context**: Full details view when DM clicks [ğŸ” Details] in preview
**Interactions**:
- [ğŸ”— View Full] â†’ Opens full-size backdrop in lightbox
- [â–¶ï¸ Preview] â†’ Plays ambient sound snippet
- [Edit State] â†’ Opens state editor (separate feature, not in this design)

---

### Staging Approval with Visual State Override

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ­ Stage the Scene: The Bar Counter                            [X]        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  ğŸ“ The Bar Counter                                                         â”‚
â”‚     Rusty Anchor Tavern                                                     â”‚
â”‚  ğŸ• Day 3, Evening (7:30 PM)                                                â”‚
â”‚  ğŸ‘¤ Waiting: Aldric the Ranger                                              â”‚
â”‚                                                                             â”‚
â”‚  â”€â”€â”€ NPCs in Scene â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                             â”‚
â”‚  [âœ“] Marcus the Bartender    [ ] Hidden                                     â”‚
â”‚  [âœ“] Old Sal                 [ ] Hidden                                     â”‚
â”‚  [ ] Mysterious Stranger      [ ] Hidden                                     â”‚
â”‚                                                                             â”‚
â”‚  â”€â”€â”€ Scene Appearance â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                             â”‚
â”‚  Location State: [â–¼ Festival of Lights      ]   [Generate New â¤]          â”‚
â”‚                   â”‚                                                           â”‚
â”‚                   â”œâ”€ Default (auto-resolved)                                 â”‚
â”‚                   â”œâ”€ Festival of Lights â† Selected                         â”‚
â”‚                   â””â”€ Under Siege                                            â”‚
â”‚                   Match: DateRange matches (Festival week, Day 22)          â”‚
â”‚                                                                             â”‚
â”‚  Region State:   [â–¼ Evening                     ]   [Generate New â¤]          â”‚
â”‚                   â”‚                                                           â”‚
â”‚                   â”œâ”€ Default (auto-resolved)                                 â”‚
â”‚                   â”œâ”€ Evening â† Selected                                    â”‚
â”‚                   â”œâ”€ Morning                                                â”‚
â”‚                   â””â”€ Post-Explosion                                        â”‚
â”‚                   Match: TimeOfDay(Evening) matches (7:30 PM)               â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ ğŸ–¼ï¸ Combined Preview                                             â”‚   â”‚
â”‚  â”‚                                                                    â”‚   â”‚
â”‚  â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚   â”‚
â”‚  â”‚ â”‚  [Layered preview: festival backdrop + warm candlelight]     â”‚ â”‚   â”‚
â”‚  â”‚ â”‚  Shows how location and region states combine visually       â”‚ â”‚   â”‚
â”‚  â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚   â”‚
â”‚  â”‚                                                                    â”‚   â”‚
â”‚  â”‚ "The tavern glows with colored lantern light from the festival   â”‚   â”‚
â”‚  â”‚  outside. Inside, warm candlelight creates a cozy atmosphere..." â”‚   â”‚
â”‚  â”‚                                                                    â”‚   â”‚
â”‚  â”‚  Location: Festival of Lights - lanterns, music, crowds         â”‚   â”‚
â”‚  â”‚  Region: Evening - candlelight, relaxed patrons                â”‚   â”‚
â”‚  â”‚                                                                    â”‚   â”‚
â”‚  â”‚                                                      [ğŸ” Details]â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  â”€â”€â”€ Cache Duration â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚  Valid for: [â–¼ 3 hours ] (until 10:30 PM game time)                         â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                        âœ“ Approve Staging                              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Context**: DM approval popup when player enters unstaged region
**Interactions**:
- Dropdowns show resolved states pre-selected with match reasons
- "Default (auto-resolved)" option allows returning to auto-resolution
- [Generate New â¤] â†’ Opens generation modal in context
- Combined preview shows how location + region states layer together
- [ğŸ” Details] â†’ Opens details modal for selected state (separate for each or combined)

---

### Visual State Catalog Browser (Library View)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“š Visual State Catalog: Rusty Anchor Tavern                   [X]        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  [ğŸ” Search states...                ]  [Type: All â–¼]  [â˜… Favorites]        â”‚
â”‚                                                                             â”‚
â”‚  â”€â”€â”€ Location States â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  [Thumbnail]  Festival of Lights                        [Active âœ“]    â”‚   â”‚
â”‚  â”‚               "City-wide celebration with lanterns and music"         â”‚   â”‚
â”‚  â”‚               Rules: DateRange(Week 3), Priority: 100               â”‚   â”‚
â”‚  â”‚               [ğŸ‘ï¸ Preview] [âœï¸ Edit] [â­]                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  [Thumbnail]  Normal Day                                          â”‚   â”‚
â”‚  â”‚               "Standard daytime appearance"                          â”‚   â”‚
â”‚  â”‚               Rules: Always, Priority: 0, [DEFAULT]                  â”‚   â”‚
â”‚  â”‚               [ğŸ‘ï¸ Preview] [âœï¸ Edit] [â­]                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  â”€â”€â”€ Region States â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  [Thumbnail]  Evening                           â­ [Used 12x]        â”‚   â”‚
â”‚  â”‚               "Warm candlelight, relaxed atmosphere"                â”‚   â”‚
â”‚  â”‚               Rules: TimeOfDay(Evening), Priority: 10                â”‚   â”‚
â”‚  â”‚               [ğŸ‘ï¸ Preview] [âœï¸ Edit] [â­]                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  [Thumbnail]  Morning                                                â”‚   â”‚
â”‚  â”‚               "Sunlight streams through dusty windows"                â”‚   â”‚
â”‚  â”‚               Rules: TimeOfDay(Morning), Priority: 10                â”‚   â”‚
â”‚  â”‚               [ğŸ‘ï¸ Preview] [âœï¸ Edit] [â­]                            â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  [Thumbnail]  Rainy Night (Generated)                                â”‚   â”‚
â”‚  â”‚               "Rain-soaked streets, flickering lantern light"        â”‚   â”‚
â”‚  â”‚               Rules: (none), Tags: [Weather: Rain] [Time: Night]      â”‚   â”‚
â”‚  â”‚               [ğŸ‘ï¸ Preview] [âœï¸ Edit] [â­]                      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                             â”‚
â”‚  [+ Create New State]                                                        â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Context**: DM browses all cataloged states from library or location view
**Interactions**:
- [ğŸ” Search] â†’ Filters by name, description, or tags
- [Type: All â–¼] â†’ Filter to Location/Region/Generated/Favorited
- [â˜… Favorites] â†’ Toggle show favorited only
- State cards â†’ Click to select, [ğŸ‘ï¸ Preview] for details, [âœï¸ Edit] to modify
- [â­] â†’ Toggle favorite status
- [+ Create New State] â†’ Opens generation modal

---

## Component Breakdown

| Component | Purpose | Existing? |
|-----------|---------|-----------|
| `VisualStateDropdown` | Dropdown with state options + Generate New button | No |
| `VisualStatePreview` | Inline thumbnail + description + match reason | No |
| `VisualStateGenerationModal` | Create new visual state with description/prompt | No |
| `VisualStateDetailsModal` | Full state details with assets and metadata | No |
| `CombinedStatePreview` | Shows how location + region states layer together | No |
| `VisualStateCatalogBrowser` | Library view of all cataloged states | No |
| `StagingApprovalPopup` | Extended with visual state dropdowns + preview | Yes (existing) |
| `PreStageModal` | Extended with visual state dropdowns + preview | Yes (existing) |

---

## Component Specification

### VisualStateDropdown

**Props:**
```rust
pub struct VisualStateDropdownProps {
    /// State type (location or region)
    pub state_type: StateType,  // Location | Region
    /// Available states from catalog
    pub available_states: Vec<VisualStateOption>,
    /// Currently selected state ID (None = auto-resolved)
    pub selected_id: Option<String>,
    /// ID of auto-resolved state (if any)
    pub resolved_id: Option<String>,
    /// Match reason for resolved state
    pub resolved_reason: Option<String>,
    /// Handler when selection changes
    pub on_select: EventHandler<Option<String>>,
    /// Handler to open generation modal
    pub on_generate: EventHandler<()>,
}
```

**Interaction:**
- Shows dropdown with "Default (auto-resolved)" first if resolved state exists
- State options show name + brief match reason in dropdown
- [Generate New â¤] button triggers `on_generate` callback

---

### VisualStatePreview

**Props:**
```rust
pub struct VisualStatePreviewProps {
    /// State to preview
    pub state: Option<VisualStateDetail>,
    /// Whether to show combined preview (location + region)
    pub combined: bool,
    /// Location state for combined preview
    pub location_state: Option<VisualStateDetail>,
    /// Region state for combined preview
    pub region_state: Option<VisualStateDetail>,
    /// Handler to open details modal
    pub on_details: EventHandler<()>,
}
```

**Interaction:**
- Shows thumbnail, description, asset paths
- Match reason if state was auto-resolved
- [ğŸ” Details] button opens `VisualStateDetailsModal`

---

### VisualStateGenerationModal

**Props:**
```rust
pub struct VisualStateGenerationModalProps {
    /// Location/region context
    pub context: GenerationContext,
    /// Scope of state (location or region)
    pub scope: StateScope,
    /// Handler when state is saved
    pub on_save: EventHandler<GeneratedStateResult>,
    /// Handler when modal is cancelled
    pub on_close: EventHandler<()>,
}
```

**Interaction:**
- Description textarea (required, max 500 chars)
- Quick presets pre-fill description + tags
- Generation triggers asset workflow, shows loading state
- On complete, shows preview of generated assets
- [Save & Use in Staging] returns state ID to calling modal

---

### VisualStateDetailsModal

**Props:**
```rust
pub struct VisualStateDetailsModalProps {
    /// State to show details for
    pub state: VisualStateDetail,
    /// Handler when modal is closed
    pub on_close: EventHandler<()>,
    /// Handler to edit state (optional, if editor exists)
    pub on_edit: Option<EventHandler<()>>,
}
```

**Interaction:**
- Full-size backdrop preview
- Description, activation rules, assets, metadata
- [ğŸ”— View Full] â†’ Lightbox for backdrop
- [â–¶ï¸ Preview] â†’ Plays ambient sound
- [Edit State] â†’ Opens editor (if available)

---

## Accessibility Considerations

- **Keyboard Navigation**: Full tab order through all modals and controls
- **Screen Readers**: ARIA labels for dropdowns, buttons, and image previews
- **Focus Management**: Modal focus traps, focus returns to trigger on close
- **Color Contrast**: All text meets WCAG AA standards (4.5:1)
- **Alternative Text**: All thumbnails have descriptive alt text
- **Error States**: Clear error messages with inline validation

---

## Animations

| Animation | Description | Duration |
|-----------|-------------|----------|
| **Modal Open/Close** | Fade in + scale from 0.95 to 1.0 | 200ms |
| **Dropdown Expand** | Slide down from 0 to max-height | 150ms |
| **Preview Update** | Fade out old, fade in new thumbnail | 300ms |
| **Generation Loading** | Pulsing spinner with progress text | N/A |
| **Thumbnail Hover** | Scale up slightly with shadow | 150ms |
| **Button Press** | Scale down 0.95 â†’ bounce back | 100ms |
| **Tag Add** | Slide in from right | 200ms |

---

## Responsive Considerations

| Breakpoint | Layout Changes |
|------------|----------------|
| < 768px (mobile) | Full-width modals, stacked state selection |
| 768px - 1024px (tablet) | Compact previews, horizontal scroll for presets |
| > 1024px (desktop) | Standard layout as shown in mockups |

---

## Error States

### Generation Failure

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âŒ Generation Failed                                                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  Could not generate visual state assets:                                    â”‚
â”‚                                                                             â”‚
â”‚  âš ï¸  Asset generation service unavailable                                    â”‚
â”‚                                                                             â”‚
â”‚  Troubleshooting:                                                           â”‚
â”‚  â€¢ Check ComfyUI connection                                                 â”‚
â”‚  â€¢ Verify model availability                                                â”‚
â”‚  â€¢ Try a simpler description                                                â”‚
â”‚                                                                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚     Try Again         â”‚  â”‚      Cancel                             â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Invalid State Selection

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš ï¸ Invalid Visual State Selected                                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚  The selected visual state is no longer available:                          â”‚
â”‚                                                                             â”‚
â”‚  Region State: "Stormy Night" (ID: vs_region_123)                           â”‚
â”‚                                                                             â”‚
â”‚  This may be due to:                                                        â”‚
â”‚  â€¢ State was deleted from catalog                                            â”‚
â”‚  â€¢ State belongs to a different location                                     â”‚
â”‚  â€¢ State ID was corrupted                                                    â”‚
â”‚                                                                             â”‚â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚        Select Different State               â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow

### Pre-Stage Flow with Existing State

```
DM opens Pre-Stage Modal
    â†“
UI requests available visual states from server
    â†“
Server returns cataloged states (VisualStateCatalogResponse)
    â†“
UI populates dropdowns with state options
    â†“
DM selects "Stormy Night" from dropdown
    â†“
UI updates preview with selected state details
    â†“
DM clicks "Pre-Stage Region"
    â†“
UI sends PreStageRegion message with:
  - npc_ids: [...]
  - location_state_id: "vs_loc_abc"
  - region_state_id: "vs_reg_123"
  - ttl_hours: 4
    â†“
Server saves staging with state IDs
    â†“
Server responds with success
    â†“
Modal closes, region card updates with "Active" status
```

### Pre-Stage Flow with Generated State

```
DM opens Pre-Stage Modal
    â†“
DM clicks "Generate New" on dropdown
    â†“
VisualStateGenerationModal opens
    â†“
DM enters description + tags
    â†“
DM clicks "Generate"
    â†“
UI sends GenerateVisualState request:
  - scope: "region"
  - region_id: "..."
  - description: "Rain-soaked..."
  - tags: ["weather:rain", "time:night"]
  - asset_style: "fantasy_realistic"
    â†“
Server generates assets via ComfyUI
    â†“
Server saves new VisualState to catalog
    â†“
Server returns GeneratedVisualStateResponse:
  - state_id: "vs_reg_generated_456"
  - backdrop_url: "/assets/generated/..."
  - sound_url: "/audio/generated/..."
    â†“
UI shows preview of generated state
    â†“
DM clicks "Save & Use in Staging"
    â†“
Modal closes, new state selected in dropdown
    â†“
DM confirms staging with generated state ID
```

---

## Related Systems

- **Depends on**: [Staging System](./staging-system.md) (integration with pre-stage/approval), [Asset System](./asset-system.md) (generation workflows)
- **Used by**: DM Panel (pre-stage modal, staging approval)
- **Data Sources**: Visual State Catalog (Neo4j nodes)

---

## Implementation Notes

### Backend Requirements

1. **VisualState Catalog Queries**:
   - `GET /api/locations/{id}/visual-states` - List location states
   - `GET /api/regions/{id}/visual-states` - List region states
   - `POST /api/visual-states/generate` - Generate new state
   - `GET /api/visual-states/{id}` - Get state details

2. **WebSocket Messages**:
   - `VisualStateCatalogResponse` - Available states for location/region
   - `GenerateVisualStateRequest` - Request new state generation
   - `GeneratedVisualStateResponse` - Generated state with assets

3. **Pre-Stage Message Extensions**:
   - `PreStageRegion` accepts `location_state_id` and `region_state_id`

### Frontend Components

1. **New Components**:
   - `VisualStateDropdown` - Dropdown + Generate New button
   - `VisualStatePreview` - Inline preview card
   - `VisualStateGenerationModal` - Generation modal
   - `VisualStateDetailsModal` - Details view modal
   - `VisualStateCatalogBrowser` - Library browser

2. **Modified Components**:
   - `StagingApprovalPopup` - Add visual state dropdowns + preview
   - `PreStageModal` - Add visual state dropdowns + preview

---

## Revision History

| Date | Change |
|------|--------|
| 2026-01-22 | Initial version - Complete UI/UX mockups for Visual State Catalog |
